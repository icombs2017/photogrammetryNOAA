---
title: "rugosity"
author: "Ian Combs -- icombs@mote.org"
output:
  html_document:
    theme: flatly
    code_folding: show
    toc: yes
    toc_depth: 3
    toc_float: yes
  pdf_doctument:
      toc: yes
      toc_depth: 3
---


```{r, setup, include = FALSE}
knitr::opts_chunk$set(warning = FALSE, fig.align = 'left')
library(magrittr)
```

### version: `r Sys.Date() %>% format(format="%B %d, %Y")`

<!-- this is where the DOI would go  [![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.3675991.svg)](https://doi.org/10.5281/zenodo.3675991)
-->


#### [GitHub repository](https://github.com/icombs2017/photogrammetryNOAA.git){target="_blank"}

###
***
This is the analysis pipeline to analyze the data generated from rugosity measurements of large-area 3D dense point clouds. The rugosity measurements were created using the visual analysis software Viscore. 


***
### All analyses performe with R verion `r getRversion()`


# Basic setup of R environment
***
## Loading required packages

For the following analyses we will require the use of a number of different R packages. Most of which can be sourced from CRAN, but some must be downloaded from GitHub. We can use the following code to load in the packages and install any packages not previously installed in the R console. 

```{r,packages, include = TRUE, message = FALSE, warning = FALSE, results = 'hide'}
if (!require("pacman")) install.packages("pacman")
pacman::p_load("ggplot2", "dplyr", "tibble")
#pacman::p_load_gh("pmartinezarbizu/pairwiseAdonis/pairwiseAdonis")
```

<br><br>

# Loading data
***

Viscore produces rugosity measurement outputs as *.csv* files. We will be loading each model's file separately. We are using `header = F` here because Viscore produces *.csv* files without headers. We will change those later. We are naming each file according to the model it originated from. 

```{r, load, include = TRUE, results = "hide}

c1 <- read.csv("../data/c1r0-lines.csv", header = F)
c2 <- read.csv("../data/c2r0-lines.csv", header = F)
u1 <- read.csv("../data/u1r0-lines.csv", header = F)
u2 <- read.csv("../data/u2r0-lines.csv", header = F)
z1 <- read.csv("../data/z1r0-lines.csv", header = F)
z2 <- read.csv("../data/z2r0-lines.csv", header = F)
head(c1)



```
<br><br>

# Data manipulation
***
The data comes Viscore without headers and with some extraneous columns. We will be using package `dplyr` to manipulate the data into a more user-friendly format. Currently, the data is given to us with a first column of some binary, we are going to remove that. The next column is the transect number, in this instance, we ran 9 transects (1m apart) so the transects should be labeled 0-8. The next column is the individual point that was placed. Here we place 1000 points (1cm apart) on each transect. The fourth column is the x coordinate, the fifth column is the y coordinate, and the sixth column is the z coordinate. The z coordinate is depth and the coordinate we want to pay particular attention to in downstream rugosity analysis. We will rename all the columns appropriately as well as give each dataframe a new column labeled "site".
```{r, manipulation, include = TRUE, results = 'hide'}
sitec1 <- "c1"
c1<- c1 %>% add_column(sitec1) %>% select(c("sitec1", "V2", "V3", "V4", "V5", "V6")) %>% rename(site = sitec1) %>% rename(transect = V2) %>% rename(point = V3) %>% rename(x = V4) %>% rename(y = V5) %>% rename(z = V6)


sitec2 <- "c2"
c2<- c2 %>% add_column(sitec2) %>% select(c("sitec2", "V2", "V3", "V4", "V5", "V6")) %>% rename(site = sitec2) %>% rename(transect = V2) %>% rename(point = V3) %>% rename(x = V4) %>% rename(y = V5) %>% rename(z = V6)

siteu1 <- "u1"
u1<- u1 %>% add_column(siteu1) %>% select(c("siteu1", "V2", "V3", "V4", "V5", "V6")) %>% rename(site = siteu1) %>% rename(transect = V2) %>% rename(point = V3) %>% rename(x = V4) %>% rename(y = V5) %>% rename(z = V6)

siteu2 <- "u2"
u2<- u2 %>% add_column(siteu2) %>% select(c("siteu2", "V2", "V3", "V4", "V5", "V6")) %>% rename(site = siteu2) %>% rename(transect = V2) %>% rename(point = V3) %>% rename(x = V4) %>% rename(y = V5) %>% rename(z = V6)

sitez1 <- "z1"
z1<- z1 %>% add_column(sitez1) %>% select(c("sitez1", "V2", "V3", "V4", "V5", "V6")) %>% rename(site = sitez1) %>% rename(transect = V2) %>% rename(point = V3) %>% rename(x = V4) %>% rename(y = V5) %>% rename(z = V6)

sitez2 <- "z2"
z2<- z2 %>% add_column(sitez2) %>% select(c("sitez2", "V2", "V3", "V4", "V5", "V6")) %>% rename(site = sitez2) %>% rename(transect = V2) %>% rename(point = V3) %>% rename(x = V4) %>% rename(y = V5) %>% rename(z = V6)


head(c1)
head(c2)
head(u1)
head(u2)
head(z1)
head(z2)



```
<br><br>

# Merging data sets

Now we want to merge datasets using the `bind_rows` function in `dplyr`.

```{r, merge, include = TRUE, results = 'hide'}

rugo <- bind_rows(c1,c2,u1,u2,z1,z2)

summary(rugo)

```

<br><br>
# Calculating variance
***
We have a very large dataset, however, what we are really concerned with is the **variance** of our z coordinate for each transect (and maybe eventually for each site). Using `dplyr` we are going to calculate our variance as well as collpase our data set so it is easier to work with. We will end up with 1 variance value for each transect within each site.


```{r, variance, include = TRUE}
rugoVar <- rugo %>% dplyr::select(site, transect, z) %>% group_by(site, transect) %>%  summarise(var(z), mean(z))

siteVar <- rugo %>% dplyr::select(site, z) %>% group_by(site) %>%  summarise(var(z), mean(z))



```









